import{a as N}from"./chunk-KNXID2YS.js";import"./chunk-74ISNC3D.js";import"./chunk-PFKTXGOQ.js";import{a as v,b as A,e as I}from"./chunk-MNXY6R3H.js";import{p as F}from"./chunk-LG3ESZ4H.js";import{Ad as M,Bb as m,Bd as x,Cd as D,Fd as f,Id as o,Mb as c,Nb as _,Nd as O,Ra as u,Sa as n,Vb as b,Wc as w,X as g,Zd as E,dc as C,ec as T,g as h,kb as S,ub as s,vb as l,wb as p}from"./chunk-IFPKIGQ4.js";var P=(()=>{let i=class i{constructor(e,t){this.dataTableService=e,this.dataService=t,this.templates=[],this.stages=[{label:"Follow",value:"follow"},{label:"Meeting",value:"meeting"},{label:"Deal",value:"deal"},{label:"Cancel",value:"cancel"},{label:"Rent",value:"rent"},{label:"Hold",value:"hold"},{label:"Reservation",value:"reservation"},{label:"EOI",value:"EOI"},{label:"Archive",value:"archive"},{label:"Reminder",value:"reminder"}],this.subscription=new h,this.addForm=new O({}),this.configs=[{controlName:"order",type:"text",label:"Order",name:"Order",placeholder:"Order",validators:[o.required],styleClass:"col-md-2 p-0"},{controlName:"title",type:"text",label:"Title in English",name:"StageName",placeholder:"Stage Name",validators:[o.required],styleClass:"col-md-5 p-0"},{controlName:"title_ar",type:"text",label:"Title in Arabic",name:"\u0627\u0633\u0645 \u0627\u0644\u0645\u0631\u062D\u0644\u0629 \u0628\u0627\u0644\u0644\u063A\u0629 \u0627\u0644\u0639\u0631\u0628\u064A\u0629",placeholder:"\u0627\u0633\u0645 \u0627\u0644\u0645\u0631\u062D\u0644\u0629 \u0628\u0627\u0644\u0644\u063A\u0629 \u0627\u0644\u0639\u0631\u0628\u064A\u0629",validators:[o.required],styleClass:"col-md-5 p-0"},{controlName:"type",optionLabel:"Type",type:"dropdown",options:this.stages,label:"Type",name:"Type",placeholder:"Input Type",validators:[o.required],styleClass:"col-md-12 p-0"},{controlName:"notify_time",optionLabel:"notify_time",type:"date",label:"notify_time",name:"notify_time",placeholder:"notify_time",validators:[],styleClass:"col-md-12 p-0",timeOnly:!0},{controlName:"delay_time",type:"date",label:"Delay Time",name:"Delay Time",placeholder:"Delay Time",validators:[o.required],styleClass:"col-md-12 p-0",timeOnly:!0},{controlName:"template_name_whatsapp",type:"dropdown",options:this.templates,label:"Template Name",name:"Template Name",placeholder:"Template",validators:[o.required],styleClass:"col-md-12 p-0"},{controlName:"template_whatsapp",type:"textarea",label:"template_whatsapp",name:"template_whatsapp",placeholder:"Write template_whatsapp",validators:[],styleClass:"col-md-12 p-0"},{controlName:"sms",type:"textarea",label:"SMS",name:"SMS",placeholder:"Write SMS here",validators:[o.required,o.minLength(10)],styleClass:"col-md-12 p-0"},{controlName:"master_plan_pop_up",type:"switch",label:"Options",name:"Options",placeholder:"master_plan_pop_up",styleClass:"col-md-12 p-0"},{controlName:"allow_rotation_delay",type:"checkbox",label:"allow_rotation_delay",name:"allow_rotation_delay",placeholder:"Allow rotation delay",styleClass:"col-md-12 p-0"},{controlName:"unit_popup_type",type:"radio",label:"unit_popup_type",name:"unit_popup_type",placeholder:"unit_popup_type",styleClass:"col-md-12 p-0"}]}ngOnInit(){this.get()}get(){this.subscription.add(this.dataService.getFn("message/templates").subscribe(e=>{this.templateList=e.list,e.list.map(t=>{this.templates.push(t.name)})}))}handlingFormActions(e){this.formActions=e}onSubmit(){this.subscription.add()}submit(){this.formData=this.formActions.getFormData(),console.log("kk",this.formData,this.formData.order)}};i.\u0275fac=function(t){return new(t||i)(n(v),n(f))},i.\u0275cmp=g({type:i,selectors:[["engaz-add-stages"]],standalone:!0,features:[b],decls:12,vars:1,consts:[[1,"addChannel"],[1,"header"],[1,"bi","bi-tag"],[1,""],[3,"config","events"],[3,"click"]],template:function(t,a){t&1&&(s(0,"div",0)(1,"div",1),p(2,"i",2),s(3,"div",3)(4,"h3"),c(5,"Add Region"),l(),s(6,"p"),c(7,"Add a new region to your crm."),l()()(),p(8,"hr"),s(9,"app-form",4),m("events",function(y){return a.handlingFormActions(y)}),l(),s(10,"button",5),m("click",function(){return a.submit()}),c(11,"submit"),l()()),t&2&&(u(9),S("config",a.configs))},dependencies:[w,E,N],styles:[".addChannel[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;position:absolute;top:6.5%}.addChannel[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;font-weight:600;line-height:28px;letter-spacing:0em;text-align:left;margin-bottom:0}.addChannel[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{border:1px solid #EAECF0;box-shadow:0 1px 2px #1018280d;padding:0 12px;font-size:20px;border-radius:10px;display:flex;align-items:center;margin:0 10px}.addChannel[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:0}.addChannel[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{width:107.3%;margin-left:-24px;color:#eaecf0}"]});let d=i;return d})();var J=(()=>{let i=class i{constructor(e,t,a,r,y){this.dataTableService=e,this.translate=t,this.dataService=a,this.dialogService=r,this.sharedModalService=y,this.subscription=new h,this.skip=0,this.take=10,this.allStages=[],this.columns=[{field:this.translate.currentLang=="en"?"title":"title_ar",header:"TITLE",type:"text",canSort:!1},{field:"type",header:"TYPE",type:"status",canSort:!1,classes:["alert-info"]},{field:"notify_time",header:"NOTIFY_TIME",type:"text",canSort:!1},{field:"delay_time",header:"DELAY_TIME",type:"text",canSort:!1}],this.actions=[{label:"EDIT",icon:"assets/images/edit-action.svg",function:this.onEdit.bind(this),btnConditionBasedField:""},{label:"DELETE",icon:"assets/images/delete-action.svg",function:this.onDelete.bind(this),btnConditionBasedField:""}],e.cols=this.columns,e.isLoading=!1,e.hasPaginator=!0,e.hasFlatActions=!0,e.actionsFlat=this.actions}ngOnInit(){this.getData(),this.getPageChanged()}getData(){this.dataTableService.isLoading=!0,this.subscription.add(this.dataService.getFn(`stage/get/bulk/${this.skip}/${this.take}`).subscribe(e=>{this.dataTableService.isLoading=!1,this.dataTableService.tableHeight="auto",this.dataTableService.totalRecords=e?.total,this.dataTableService.rows.set(e?.list)}))}onEdit(e){}onDelete(e){let t={title:"Are you sure to delete this stage?",message:"",type:"error",btnLabel:"DELETE"};this.sharedModalService.confirmCard(t).onClose.subscribe(a=>{a=="confirm"&&this.deleteChannel(e)})}deleteChannel(e){let t=e.stage_id;this.subscription.add(this.dataService.deleteFn(`stage/delete/${t}`).subscribe(a=>{a?.status?this.sharedModalService.successBasicCard({title:"Stage Deleted Successfully",message:"",btnLabel:"OKAY"}).onClose.subscribe(r=>{this.getData()}):this.getAllStages(t)}))}reassign(e){this.subscription.add(this.dataService.postFn("stage/terminate",{newstage:this.sharedModalService.selectedItemReassigned?.id,oldstage:e}).subscribe(()=>{this.sharedModalService.successBasicCard({title:"Assigned Successfully",btnLabel:"THANK_YOU"}).onClose.subscribe(()=>{this.getData()})}))}handleReasign(e){this.sharedModalService.reassignModal({items:this.allStages,title:"Assign Stage"}).onClose.subscribe(t=>{t=="reassign"&&this.reassign(e)})}getPageChanged(){this.subscription.add(this.dataTableService.getPageChanged().subscribe(e=>{this.skip=e.page*e.rows,this.take=e.rows,this.getData()}))}newStages(){this.ref=this.dialogService.open(P,{width:"50vw",modal:!0,breakpoints:{"960px":"75vw","640px":"90vw"}})}getAllStages(e){this.subscription.add(this.dataService.getFn("stage/get/bulk/0/-1").subscribe(t=>{let a=t?.list;this.allStages=a.map(r=>({title:r.title,id:r.stage_id})),this.handleReasign(e)}))}ngOnDestroy(){this.subscription.unsubscribe(),this.sharedModalService.selectedItemReassigned={}}};i.\u0275fac=function(t){return new(t||i)(n(v),n(M),n(f),n(F),n(I))},i.\u0275cmp=g({type:i,selectors:[["app-stages-list"]],standalone:!0,features:[b],decls:9,vars:3,consts:[[1,"p-4"],[1,"d-flex","justify-content-between","mb-3"],[1,"btn","bg-btn","text-white",3,"click"],[1,"position-relative","shadow","rounded"]],template:function(t,a){t&1&&(s(0,"div",0)(1,"div",1)(2,"h3"),c(3),C(4,"translate"),l(),s(5,"button",2),m("click",function(){return a.newStages()}),c(6,"New Stage"),l()(),s(7,"div",3),p(8,"data-table"),l()()),t&2&&(u(3),_(T(4,1,"STAGES_LIST")))},dependencies:[A,D,x]});let d=i;return d})();export{J as StagesListComponent};
